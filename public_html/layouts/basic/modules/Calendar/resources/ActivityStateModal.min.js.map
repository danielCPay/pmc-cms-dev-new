{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Calendar_ActivityStateModal_Js',\n\t{},\n\t{\n\t\tregisterActivityState() {\n\t\t\tconst self = this;\n\t\t\t$('.js-activity-buttons button:not(.close)').on('click', function (e) {\n\t\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\t\tviewName = app.getViewName();\n\t\t\t\t// read note, if not available then show error, otherwise continue\n\t\t\t\tlet note = currentTarget.closest('div:has(.fieldValue textarea[name=\"note\"])').find('.fieldValue textarea[name=\"note\"]');\n\t\t\t\tlet noteVal = note.val();\n\t\t\t\tif (!note || !noteVal || noteVal.length === 0) {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_STATE_NOTE_REQUIRED'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\t\tself.updateActivityState(currentTarget, noteVal);\n\t\t\t\t} else {\n\t\t\t\t\tlet isReminder = currentTarget.closest('#calendar-reminder-modal').length;\n\t\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'CalendarExtended' && !isReminder) {\n\t\t\t\t\t\tlet calendarInstance = new Calendar_CalendarExtended_Js();\n\t\t\t\t\t\tcalendarInstance.getCalendarSidebarData({\n\t\t\t\t\t\t\tmodule: 'Calendar',\n\t\t\t\t\t\t\tview: 'EventForm',\n\t\t\t\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\t\t\t\tisDuplicate: true,\n\t\t\t\t\t\t\taddRelation: true,\n\t\t\t\t\t\t\tsourceModule: 'Calendar',\n\t\t\t\t\t\t\tsourceRecord: currentTarget.data('id')\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (currentTarget.hasClass('showQuickCreate') || isReminder) {\n\t\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\turl =\n\t\t\t\t\t\t\t\t'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' +\n\t\t\t\t\t\t\t\tcurrentTarget.data('id'),\n\t\t\t\t\t\t\tparams = {},\n\t\t\t\t\t\t\tsubject = currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject');\n\t\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\t\tApp.Components.QuickCreate.getForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tif (currentTarget.data('type') == '0' && typeof subject !== 'undefined' && subject.length > 0) {\n\t\t\t\t\t\t\t\tdata = $(data);\n\t\t\t\t\t\t\t\tlet element = data.find('[name=\"subject\"]');\n\t\t\t\t\t\t\t\tif (element.length) {\n\t\t\t\t\t\t\t\t\telement.val(subject);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tApp.Components.QuickCreate.showModal(data, {\n\t\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdateActivityState: function (currentTarget, note) {\n\t\t\tlet params = {\n\t\t\t\tmodule: 'Calendar',\n\t\t\t\taction: 'ActivityStateAjax',\n\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\tstate: currentTarget.data('state'),\n\t\t\t\tnote\n\t\t\t};\n\t\t\tapp.hideModalWindow();\n\t\t\tlet progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\t\trecentActivitiesTab =\n\t\t\t\t\t\t\t\t\t!thisInstance.getSelectedTab().length ||\n\t\t\t\t\t\t\t\t\tthisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel\n\t\t\t\t\t\t\t\t\t\t? thisInstance\n\t\t\t\t\t\t\t\t\t\t\t\t.getTabContainer()\n\t\t\t\t\t\t\t\t\t\t\t\t.find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)')\n\t\t\t\t\t\t\t\t\t\t: $('<div></div>');\n\t\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t\tnew Vtiger_DashBoard_Js().getContainer().find('a[name=\"drefresh\"]').trigger('click');\n\t\t\t\t\t}\n\t\t\t\t\tif (app.getModuleName() === 'Calendar' && (viewName === 'Calendar' || viewName === 'CalendarExtended')) {\n\t\t\t\t\t\tconst calendarInstance = new window[`Calendar_${viewName}_Js`]();\n\t\t\t\t\t\tcalendarInstance.loadCalendarData();\n\t\t\t\t\t\tcalendarInstance.getCalendarCreateView();\n\t\t\t\t\t}\n\t\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tthis.registerActivityState();\n\t\t}\n\t}\n);\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","registerActivityState","$","on","e","currentTarget","viewName","app","getViewName","note","closest","find","noteVal","val","length","showNotify","text","vtranslate","type","hideModalWindow","data","self","updateActivityState","getModuleName","isReminder","calendarInstance","getCalendarSidebarData","module","view","record","isDuplicate","addRelation","sourceModule","sourceRecord","hasClass","progressIndicator","position","blockInfo","enabled","url","params","subject","noCache","App","Components","QuickCreate","getForm","done","progressIndicatorElement","mode","element","showModal","callbackFunction","success","result","followup","value","action","state","AppConnector","request","Vtiger_Detail_Js","getInstance","widget","thisInstance","loadWidget","getTabByLabel","detailViewRecentActivitiesTabLabel","recentActivitiesTab","trigger","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","addClass","listinstance","getListViewRecords","getContainer","loadCalendarData","getCalendarCreateView","Vtiger_Index_Js","requestReminder","registerEvents","document","ready","instance"],"mappings":"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"}