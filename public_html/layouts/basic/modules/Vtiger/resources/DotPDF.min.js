'use strict';

$.Class('Vtiger_DotPDF_Js',{/*
	 * Function to register the click event for generate button
	 */registerPreSubmitEvent:function registerPreSubmitEvent(container){var _this=this;container.find('#generate_dot_pdf').on('click',function(e){e.preventDefault();var loader=$.progressIndicator({message:app.vtranslate('JS_PDF_GENERATING'),position:'html',blockInfo:{enabled:!0}}),templateElements=container.find('[name="pdf_template[]"]'),templateContainer=$(_this).closest('.js-pdf-template-content');templateContainer.find('.js-pdf-user-variable').toggleClass('d-none');var templates=[];templateElements.filter(':checked').each(function(){templates.push($(this).val());});var params=container.find('form').serializeFormData();params.templates=templates,params.mode='generate',AppConnector.request(params).done(function(data){var response=data.result;response.message&&app.showNotify({text:response.message,type:data.success?'success':'error'});var detailInstance=Vtiger_Detail_Js.getInstance();detailInstance&&detailInstance.reloadTabContent();}).fail(function(data,err){app.errorLog(data,err);}),loader.progressIndicator({mode:'hide'}),app.hideModalWindow();});},/**
	 * Register list view check records
	 *
	 * @param   {jQuery}  container
	 */registerListViewCheckRecords:function registerListViewCheckRecords(container){var templateElements=container.find('[name="pdf_template[]"]');templateElements.on('change',function(){document.progressLoader=$.progressIndicator({message:app.vtranslate('JS_PDF_RECALCULATING'),position:'html',blockInfo:{enabled:!0}});var templateContainer=$(this).closest('.js-pdf-template-content');templateContainer.find('.js-pdf-user-variable').toggleClass('d-none');var templates=[];templateElements.filter(':checked').each(function(){templates.push($(this).val());});var params=container.find('form').serializeFormData();params.mode='validateRecords',params.templates=templates,AppConnector.request(params).done(function(data){var response=data.result;if(data.success){var valid=response.valid,info=container.find('.js-records-info').text(response.message).removeClass('d-none');valid&&info.addClass('d-none'),setTimeout(function(){document.progressLoader.progressIndicator({mode:'hide'});},500),container.find('.js-submit-button').each(function(){$(this).attr('disabled',!valid);});}}).fail(function(data,err){app.errorLog(data,err);});});},/**
	 * Register select custom columns change
	 */registerSelectCustomColumnsChange:function registerSelectCustomColumnsChange(){var _this2=this;this.container.find('[name="isCustomMode"]').on('change',function(ev){$(ev.target).is(':checked')?(_this2.container.find('[name="inventoryColumns[]"]').prop('disabled',null),_this2.container.find('.js-save-scheme').prop('disabled',null)):(_this2.container.find('[name="inventoryColumns[]"]').prop('disabled','disabled'),_this2.container.find('.js-save-scheme').prop('disabled','disabled'));});},/**
	 * Register save scheme button click
	 */registerSaveInventoryColumnSchemeClick:function registerSaveInventoryColumnSchemeClick(){var _this3=this;this.container.find('.js-save-scheme').on('click',function(e){e.preventDefault(),e.stopPropagation();var loader=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params=_this3.container.find('form').serializeFormData();params.mode='saveInventoryColumnScheme',params.isCustomMode=_this3.container.find('[name="isCustomMode"]').is(':checked'),AppConnector.request(params).done(function(data){var response=data.result;data.success&&loader.progressIndicator({mode:'hide'}),response.message&&data.success&&app.showNotify({text:response.message,type:'success'});}).fail(function(data,err){app.errorLog(data,err);});});},registerListViewFilter:function registerListViewFilter(container){container.find('.templates-filter').on('keyup',function(e){var element=$(e.currentTarget),filter=element.val().toLowerCase(),classes=element.attr('class').split(/\s+/),column='column-name',_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,className,_iterator=classes[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)if(className=_step.value,className.startsWith('column-')){column=className;break}}catch(err){_didIteratorError=!0,_iteratorError=err;}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();}finally{if(_didIteratorError)throw _iteratorError}}container.find('.js-pdf-template-content.row').each(function(){var element=$(this),labelElement=element.find('label.'+column),label=labelElement.text();filter&&-1===label.toLowerCase().indexOf(filter)?element.addClass('d-none'):element.removeClass('d-none');});});},/**
	 * Register events
	 */registerEvents:function registerEvents(){var container=this.container=$('#dotPdfExportModal').closest('.js-modal-container');this.dynamicTemplatesCount=0,this.recordId=parseInt(container.find('[name="record"]').val()),this.registerPreSubmitEvent(container),this.registerSaveInventoryColumnSchemeClick(),this.registerSelectCustomColumnsChange(),this.registerListViewCheckRecords(container),this.registerListViewFilter(container);}}),$(function(){new Vtiger_DotPDF_Js().registerEvents();});
//# sourceMappingURL=DotPDF.min.js.map
